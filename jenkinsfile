pipeline {
    agent {
        docker {
            image 'maven:3.8.6-openjdk-11'
            args '-u root:root'
        }
    }
    stages {
        stage('Run  Tests') {
            steps {
                sh 'mvn clean install -DskipTests'
                sh 'mvn jmeter:configure'
                sh 'mvn compile'
                // sh 'mvn jmeter:jmeter'

            }
        }
         stage('Run JMeter ') {
            steps {
                sh 'mvn jmeter:jmeter'
                
            }
        }
    }
   post {
    always {
        mail(
            to: 'ahmedzwawi46@gmail.com',
            subject: "[Jenkins] ğŸ“¦ ${env.JOB_NAME} - Build #${env.BUILD_NUMBER} - ${currentBuild.currentResult}",
            body: """\
Bonjour,

Le pipeline : *${env.JOB_NAME}* (Build #${env.BUILD_NUMBER}) s'est exÃ©cutÃ© avec le statut : *${currentBuild.currentResult}*.

ğŸ“… Date       : ${new Date().format("dd/MM/yyyy HH:mm", TimeZone.getTimeZone('Europe/Paris'))}
â±ï¸ DurÃ©e     : ${currentBuild.durationString}
ğŸ”€ Branche    : ${env.GIT_BRANCH ?: 'Branche non dÃ©finie'}
ğŸ‘¤ DÃ©clenchÃ© par : ${currentBuild.getBuildCauses()[0]?.shortDescription ?: 'Non spÃ©cifiÃ©'}
ğŸ”— Lien vers le build : ${env.BUILD_URL}
ğŸ“„ Console output : ${env.BUILD_URL}console
ğŸ“Š Rapport de tests (Allure): ${env.BUILD_URL}allure/


Cordialement,  
Votre Jenkins prÃ©fÃ©rÃ© ğŸ¤–
"""
        )
    }
}



}
