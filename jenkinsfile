pipeline {
    agent {
        docker {
            image 'maven:3.8.6-openjdk-11'
            args '-u root:root'
        }
    }
    stages {
        stage('Run  Tests') {
            steps {
                sh 'mvn clean install -DskipTests'
                sh 'mvn jmeter:configure'
                sh 'mvn compile'
                // sh 'mvn jmeter:jmeter'

            }
        }
         stage('Run JMeter ') {
            steps {
                sh 'mvn jmeter:jmeter'
                
            }
        }
    }
    post {
        always {
        mail(
            to: 'ahmedzwawi46@gmail.com',
            subject: "Pipeline ${env.JOB_NAME} - Build #${env.BUILD_NUMBER} - ${currentBuild.currentResult}",
            body: "Le pipeline ${env.JOB_NAME} a terminé avec le statut ${currentBuild.currentResult}. Voir les détails ici: ${env.BUILD_URL}"
        )
    }
}


}
